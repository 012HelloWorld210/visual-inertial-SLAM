# 代码涉及到的数学概念

## 1.测试视频设备

​	简单测试，无涉及。

## 2.特征检测与匹配

### ORB特征检测

#### 概述

​	ORB（Oriented FAST and Rotated BRIEF，带方向的FAST和旋转的BRIEF），其是建立在特征检测方法fast（Features from Accelerated Segment Test，加速分割测试特征）的特征检测方法。

#### fast

​	FAST算法通过检查图像中的某像素点周围是否包含足够数量的与该点有明显的亮度差的像素点来确认是否为角点。具体而言，先确定一个像素点，并以此点为中心画一个圆（通常选择半径为3的圆，即检查其周围16个像素点），如果存在N个连续的像素点（一般N取值为9）均比中心点亮，或均比中心点暗，则该点就被认定为是一个角点。详细如下图所示：

<img src="D:\postgraduate\长期事件\可累计的技能\手搭SLAM\image\Fast角点.jpg" alt="fast" style="zoom:60%;" />

其步骤包括：1）在图像中任选一点p， 假定其像素（亮度）值为 Ip。

 2）以r为半径画圆，覆盖p点周围的M个像素，如图3.1所示: r=3， M=16。

 3）设定阈值t，如果周围16个像素中有连续的N个像素的像素值小于 Ip−t 或者有连续的N个像素都大于 Ip+t ，则该点就被判断为角点。

#### orb

​	在fast基础上，使用质心公式计算出图片的质心坐标

![质心公式](D:\postgraduate\长期事件\可累计的技能\手搭SLAM\image\质心公式.png)

​	式中，（X,Y）为像素点坐标，I（X,Y）为该点灰度值

​	而orb中的方向即质心坐标指向角点坐标的方向；有此方向后，即使在后续图片进行旋转，也可以将坐标进行对应的旋转从而保持区域内的像素特征不变化（主要为后续的特征子描述做准备）。

​	描述子是在求取角点位置信息后，通过统计角点所在区域（大小通常可自定）像素点的特征，如直方图等来对于角点所在区域进行描述，称为描述子。而BRIEF（Binary Robust Independent Elementary Features，二值独立基本特征）描述子具体实现为：

​	1）关键点检测：使用如FAST等关键点检测算法在图像找到感兴趣点。

​	2）图像补丁提取：在每个关键点周围提取一个小的图像补丁，即选择区域。

​	3）二元比较对选择：在提取的图像补丁内，通过预定义或通过方法优化，随机选择一组像素对（通常是128或256对）。

​	4）生成二进制描述符：对于每对像素，比较其灰度值，如第一个像素的灰度值小于第二个像素，则该对对应的位设为1，否则设为0。结果每个补丁可生成一个二进制字符串，称为该关键点的描述符。

### 汉明距离的BFMatcher

​	BFMatcher（Brute-Force Matcher）是一种暴力匹配的方法，可以使用不同的距离度量标准，其中汉明距离（Hamming Distance）常用于二进制描述符（如ORB、BRIEF等）的匹配。

​	汉明距离计算两个二进制字符串之间不同位的数量，用于衡量它们的相似度。BFMatcher使用汉明距离来找到在两张图像中最相似的特征点，从而实现图像匹配和对齐。

具体流程如下所示：

1. **遍历图片1的描述符**：

   对于每一个来自图片1的描述符（如 `d1`），`BFMatcher` 会执行下面的操作。

2. **逐一配对**：   

    `BFMatcher` 会将这个描述符 `d1` 与图片2中的每一个描述符（如 `d2`）进行比较，计算它们之间的距离（通常是欧氏距离）。

3. **选择最近邻**：  

   从所有计算出的距离中，选择最小的那个，即找到与 `d1` 距离最近的描述符 `d2`。

4. **记录匹配结果**：

      - 将该对描述符（`d1` 和 `d2`）作为一个匹配结果存储起来，包含实际的描述符索引和距离值。

5. **重复过程**： 

      对图片1中的每一个描述符重复上述过程，直到所有描述符都完成匹配。

​    这种方法确保了每个描述符都能找到在另一个图像中的最佳匹配，但也意味着计算量较大，特别是对于包含大量特征点的图像，匹配计算会非常耗时。

​    为了加速匹配过程或者提高准确性，实际应用中常常会使用一些优化和过滤方法，如：

​    \- **K近邻匹配（KNN matching）**：除了最近邻，还会找出前K个最近的描述符，通过进一步筛选来提高匹配准确度。

​    \- **交叉验证匹配（Cross-checking）**：匹配必须是对称的，即如果描述符1匹配到描述符2，那么描述符2也应该匹配回描述符1。

​    \- **比值测试（Ratio test）**：应用在KNN匹配中，通过比较最近的两个距离的比值来过滤掉一些错误匹配。

## 3.RANSAC优化

### 获取位置

```
[ keypoints1[m.queryIdx].pt for m in matches ]
```

​	首先从maches中获得匹配的特征点信息，此处的m.queryIdx即为第一张图片特征点中的匹配点索引，通过.pt即可获得其对应的二维坐标。

### RANSAC估计几何变换矩阵

```
M, mask = cv2.findHomography(pts1, pts2, cv2.RANSAC, 5.0)
```

​	此处指定模型为单映射矩阵，通过RANSAC方法进行迭代随机采样和评估模型质量，误差阈值为设置为5。返回值M为对应的单映射矩阵；mask返回 指示哪些点是内点（inliers）或外点（outliers），具体来说：

\- `mask` 中的值为 `1` 的位置表示该点对是内点，即在计算单映射矩阵时，被认为是符合预期变换模型的可靠点。

\- `mask` 中的值为 `0` 的位置表示该点对是外点，即被认为是误差较大的点，可能是由于噪声或错误匹配导致的。

#### 单映射矩阵

​	一种用于描述两个平面之间对应关系的3x3变换矩阵。在计算机视觉和图像处理领域，单映射矩阵通常用于将一个图像中的点映射到另一个图像中的相应点。

![单映射矩阵](D:\postgraduate\长期事件\可累计的技能\手搭SLAM\image\单映射矩阵.jpg)

​	X是空间中的一点，左右两边是射影平面（摄像头）。单应是关于三维齐次矢量的一种线性变换，可以用一个3×3的非奇异矩阵H表示，这个矩阵H称为**单应矩阵**。使用这个矩阵，就可以将射影平面上的一个点投影到另一个平面上（图中的 *m* 投影到 *m‘*）。

![变换矩阵](D:\postgraduate\长期事件\可累计的技能\手搭SLAM\image\变换矩阵.jpg)

​	